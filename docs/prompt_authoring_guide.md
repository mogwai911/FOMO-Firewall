# FOMO Firewall Prompt 编写指南

## 1. 目标
- 让 prompt 可维护、可验证、可替换。
- 让模型输出稳定服务于产品流程，而不是“看起来聪明但不可执行”。
- 降低用户自定义 prompt 时把系统搞崩的概率。

## 2. 统一结构
每个系统级 prompt 必须包含 7 段：
1. `角色定义`：你是谁、边界是什么。
2. `任务目标`：这次要解决什么决策问题。
3. `输入上下文`：变量列表与字段语义。
4. `输出契约`：字段、类型、顺序、约束。
5. `质量门槛`：什么叫“合格输出”。
6. `失败策略`：信息不足时怎么降级。
7. `禁止项`：不允许编造、不允许跑题、不允许多余格式。

## 3. 分流 Prompt（Triage）规范
- 输出格式：只允许 JSON。
- 决策动作：必须收敛到三选一（去学习 / 稍后看 / 忽略）。
- 推荐字段：
  - `label`: `FYI|DO|DROP`
  - `headline`: 必须包含“价值判断 + 建议动作”
  - `reasons`: 2~3 条，且与当前 feed 强相关
  - `snippets`: 最多 2 条，引用证据而非复述废话
  - `next_action_hint`: 固定映射
  - `score`: 0~100
- 质量红线：
  - 禁止“信息有参考价值”这类空泛句作为唯一理由。
  - 理由至少有一条落在“价值/风险/可执行性”。

## 4. 学习助手 Prompt 规范
- 输出格式：Markdown 结构化回答（标题固定）。
- 固定四段：
  - `结论`
  - `关键依据`
  - `风险与边界`
  - `下一步动作`
- 质量红线：
  - 不允许“高大上总结”但没有执行步骤。
  - 下一步动作必须包含顺序与验收标准。
  - 信息不足时必须明确“缺什么 + 怎么补”。

## 5. 变量设计原则
- 变量命名必须稳定、直观、语义单一。
- 不在模板里拼装复杂逻辑（逻辑放代码，模板只声明规则）。
- 推荐变量：
  - Triage: `{{role}} {{title}} {{summary}} {{sourceName}} {{url}} {{extractedText}}`
  - Session: `{{signalTitle}} {{signalSummary}} {{signalSourceName}} {{signalUrl}} {{signalArticleExcerpt}}`

## 6. 迭代流程（必须走 TDD）
1. 先写失败用例（输出结构、文案关键约束、回退行为）。
2. 调整 prompt。
3. 回归单测 + e2e 主链路。
4. 记录到 `docs/development-log.md` 与 checklist。

## 7. 安全与合规
- prompt 中不得包含真实密钥、token、账号信息。
- 不把 `apiKey` 拼到 prompt 或日志中。
- 不依赖模型泄露内部 system prompt 才能完成任务。
